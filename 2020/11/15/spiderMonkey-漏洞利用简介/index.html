<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="“一个不像二进制同学的博客。”"><title>spiderMonkey 漏洞利用简介 | f01965</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + 'true';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
  </script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">spiderMonkey 漏洞利用简介</h1><a id="logo" href="/.">f01965</a><p class="description">初闻不知曲中意，再听已是曲中人。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">spiderMonkey 漏洞利用简介</h1><div class="post-meta">Nov 15, 2020<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a class="disqus-comment-count" href="/2020/11/15/spiderMonkey-漏洞利用简介/#vcomment"><span class="valine-comment-count" data-xid="/2020/11/15/spiderMonkey-漏洞利用简介/"></span><span> 条评论</span></a><div class="post-content"><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>这个博客文章介绍了针对 SpiderMonkey JavaScript Shell 解释器和 Windows 10 RS5 64 位 Mozilla Firefox 的三个漏洞的开发，从一个从未编写过浏览器漏洞利用的人的角度来写，也没有密切关注任何 JavaScript 引擎代码库。<br>您可能已经注意到，在过去的一两年里，人们对利用浏览器产生了很大的兴趣。每个主要的 CTF 竞赛至少有一次浏览器挑战，每个月至少有一次或两次涉及浏览器利用。这就是为什么我认为我应该从内部分析一下 JavaScript 引擎的内容，然后写一个其中的利用。我选择了 Firefox 的 SpiderMonkey JavaScript 引擎和由 <a href="https://twitter.com/itszn13" title="itszn13" target="_blank" rel="noopener">itszn13</a> 出的挑战题 <a href="https://ctftime.org/task/6000" title="Blazefox" target="_blank" rel="noopener">Blazefox</a>。<br>在这篇文章中，我介绍了我的发现和我在此挑战中编写的三个利用。最初，挑战是针对 Linux x64 环境，但我决定在 Windows x64 上利用它。现在你知道为什么有 3 种不同的利用了吗？三个不同的利用允许我一步一步地实现，而不是同时面对所有复杂的情况。这通常是我日常工作的方式，我只是做了一些小工作，慢慢迭代然后建立起来。<br>以下是我如何组织这些事情的方法：</p>
<ul>
<li>第一件事，我写了一个名为 <a href="https://github.com/0vercl0k/windbg-scripts/tree/master/sm" title="sm.js" target="_blank" rel="noopener">sm.js</a> 的 WinDbg JavaScript 扩展，它让我可以看到 SpiderMonkey 中的一堆东西。熟悉对象在内存中组织的各种方式也是一种很好的练习。这不是必要操作，但在编写漏洞时它一定非常有用。</li>
<li>第一个利用部分：basic.js，针对 JavaScript 解释器 js.exe 的一个非常具体的构建。它里面写满了硬编码的偏移，并且没有办法到我的系统以外的其他地方使用这个特定版本的 js.exe 。</li>
<li>第二个利用部分，kaizen.js，是对 basic.js 的改进版。 它仍然以 JavaScript 解释器本身为目标，但这一次，它能动态地解决了一大堆东西。 它还使用 baseline JIT 让它生成 ROP gadgets。</li>
<li>第三个利用部分，ifrit.js，最后用一点额外的操作定位Firefox浏览器。我们就不仅是利用 baseline 来生成一个或两个 ROP gadgets，而是将 JIT 编写到一个完整的 payload 中。不需要 ROP 链，直接扫描以查找 Windows API 地址或创建可写和可执行的内存区域。我们只需要将执行的 payload 放到 JIT 代码的位置。对于了解 SpiderMonkey 并且已经写过浏览器利用的人来说，这可能是一个不那么枯燥，且有趣的部分。   </li>
</ul>
<p>在开始之前，对于那些不想阅读整个文章的人：我已经创建了一个<a href="https://github.com/0vercl0k/blazefox" title="blazefox GitHub" target="_blank" rel="noopener">blazefox GitHub</a>存储库，您可以克隆所有材料。 在存储库中，还可以找到：</p>
<ul>
<li>sm.js 这是上面提到的调试器扩展</li>
<li>3个利用部分的源码</li>
<li>JavaScript shell 的64位调试版本，js-asserts 中的私有符号信息，以及 js-release 中的发布版本</li>
<li>用来在脚本中构建你自己 payload 技术的脚本</li>
<li>用于构建 js-release 的源代码，以便您可以在 <a href="https://github.com/0vercl0k/blazefox/tree/master/src/js" title="src/js" target="_blank" rel="noopener">src/js</a> 中的 WinDbg 中进行源代码级调试</li>
<li>一个 64 位版本的 Firefox 二进制文件以及 <a href="https://github.com/0vercl0k/blazefox/blob/master/ff-bin.7z.001" title="ff-bin.7z.001 " target="_blank" rel="noopener">ff-bin.7z.001 </a>和 <a href="https://github.com/0vercl0k/blazefox/blob/master/ff-bin.7z.002" title="ff-bin.7z.002" target="_blank" rel="noopener">ff-bin.7z.002</a> 中 xul.dll 符号信息<br>好，让我们开始吧。</li>
</ul>
<h2 id="Setting-it-up-设置它"><a href="#Setting-it-up-设置它" class="headerlink" title="Setting it up 设置它"></a>Setting it up 设置它</h2><p>当然，必须设置一个调试环境。 我建议为此创建一个虚拟机，因为您将不得不安装一些您可能不想在您的个人计算机上安装的东西。<br>首先，我们先拿到源码。Mozilla 使用 mercurial 进行开发，但它们也维护一个只读的 GIT 镜像。我建议只是克隆这个存储库，这样更快（存储库大约~420MB）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;git clone --depth 1 https://github.com/mozilla/gecko-dev.git</span><br><span class="line">Cloning into &apos;gecko-dev&apos;...</span><br><span class="line">remote: Enumerating objects: 264314, done.</span><br><span class="line">remote: Counting objects: 100% (264314/264314), done.</span><br><span class="line">remote: Compressing objects: 100% (211568/211568), done.</span><br><span class="line">remote: Total 264314 (delta 79982), reused 140844 (delta 44268), pack-reused 0 receiving objects: 100% (264314/26431</span><br><span class="line">Receiving objects: 100% (264314/264314), 418.27 MiB | 981.00 KiB/s, done.</span><br><span class="line">Resolving deltas: 100% (79982/79982), done.</span><br><span class="line">Checking out files: 100% (261054/261054), done.</span><br></pre></td></tr></table></figure></p>
<p>现在，我们只对创建 JavaScript Shell 的解释器感兴趣，这只是 SpiderMonkey 树的一部分。js.exe 是一个可以运行 JavaScript 代码的简单命令行程序。 编译速度要快得多，但更重要的是它更容易攻击和推理。js.exe是一个可以运行JavaScript代码的简单命令行实用程序。 编译速度要快得多，但更重要的是更容易攻击和推理。我们已经准备好放弃代码，所以让我们首先关注一些细微的东西。<br>在编译之前，抓取 <a href="https://github.com/0vercl0k/blazefox/blob/master/blaze.patch" title="blaze.patch" target="_blank" rel="noopener">blaze.patch</a> 文件（暂时不需要理解）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">diff -r ee6283795f41 js/src/builtin/Array.cpp</span><br><span class="line">--- a/js/src/builtin/Array.cpp  Sat Apr 07 00:55:15 2018 +0300</span><br><span class="line">+++ b/js/src/builtin/Array.cpp  Sun Apr 08 00:01:23 2018 +0000</span><br><span class="line">@@ -192,6 +192,20 @@</span><br><span class="line">     return ToLength(cx, value, lengthp);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">+static MOZ_ALWAYS_INLINE bool</span><br><span class="line">+BlazeSetLengthProperty(JSContext* cx, HandleObject obj, uint64_t length)</span><br><span class="line">+&#123;</span><br><span class="line">+    if (obj-&gt;is&lt;ArrayObject&gt;()) &#123;</span><br><span class="line">+        obj-&gt;as&lt;ArrayObject&gt;().setLengthInt32(length);</span><br><span class="line">+        obj-&gt;as&lt;ArrayObject&gt;().setCapacityInt32(length);</span><br><span class="line">+        obj-&gt;as&lt;ArrayObject&gt;().setInitializedLengthInt32(length);</span><br><span class="line">+        return true;</span><br><span class="line">+    &#125;</span><br><span class="line">+    return false;</span><br><span class="line">+&#125;</span><br><span class="line">+</span><br><span class="line">+</span><br><span class="line">+</span><br><span class="line"> /*</span><br><span class="line">  * Determine if the id represents an array index.</span><br><span class="line">  *</span><br><span class="line">@@ -1578,6 +1592,23 @@</span><br><span class="line">     return DenseElementResult::Success;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">+bool js::array_blaze(JSContext* cx, unsigned argc, Value* vp)</span><br><span class="line">+&#123;</span><br><span class="line">+    CallArgs args = CallArgsFromVp(argc, vp);</span><br><span class="line">+    RootedObject obj(cx, ToObject(cx, args.thisv()));</span><br><span class="line">+    if (!obj)</span><br><span class="line">+        return false;</span><br><span class="line">+</span><br><span class="line">+    if (!BlazeSetLengthProperty(cx, obj, 420))</span><br><span class="line">+        return false;</span><br><span class="line">+</span><br><span class="line">+    //uint64_t l = obj.as&lt;ArrayObject&gt;().setLength(cx, 420);</span><br><span class="line">+</span><br><span class="line">+    args.rval().setObject(*obj);</span><br><span class="line">+    return true;</span><br><span class="line">+&#125;</span><br><span class="line">+</span><br><span class="line">+</span><br><span class="line"> // ES2017 draft rev 1b0184bc17fc09a8ddcf4aeec9b6d9fcac4eafce</span><br><span class="line"> // 22.1.3.21 Array.prototype.reverse ( )</span><br><span class="line"> bool</span><br><span class="line">@@ -3511,6 +3542,8 @@</span><br><span class="line">     JS_FN(&quot;unshift&quot;,            array_unshift,      1,0),</span><br><span class="line">     JS_FNINFO(&quot;splice&quot;,         array_splice,       &amp;array_splice_info, 2,0),</span><br><span class="line"></span><br><span class="line">+    JS_FN(&quot;blaze&quot;,            array_blaze,      0,0),</span><br><span class="line">+</span><br><span class="line">     /* Pythonic sequence methods. */</span><br><span class="line">     JS_SELF_HOSTED_FN(&quot;concat&quot;,      &quot;ArrayConcat&quot;,      1,0),</span><br><span class="line">     JS_INLINABLE_FN(&quot;slice&quot;,    array_slice,        2,0, ArraySlice),</span><br><span class="line">diff -r ee6283795f41 js/src/builtin/Array.h</span><br><span class="line">--- a/js/src/builtin/Array.h    Sat Apr 07 00:55:15 2018 +0300</span><br><span class="line">+++ b/js/src/builtin/Array.h    Sun Apr 08 00:01:23 2018 +0000</span><br><span class="line">@@ -166,6 +166,9 @@</span><br><span class="line"> array_reverse(JSContext* cx, unsigned argc, js::Value* vp);</span><br><span class="line"></span><br><span class="line"> extern bool</span><br><span class="line">+array_blaze(JSContext* cx, unsigned argc, js::Value* vp);</span><br><span class="line">+</span><br><span class="line">+extern bool</span><br><span class="line"> array_splice(JSContext* cx, unsigned argc, js::Value* vp);</span><br><span class="line"></span><br><span class="line"> extern const JSJitInfo array_splice_info;</span><br><span class="line">diff -r ee6283795f41 js/src/vm/ArrayObject.h</span><br><span class="line">--- a/js/src/vm/ArrayObject.h   Sat Apr 07 00:55:15 2018 +0300</span><br><span class="line">+++ b/js/src/vm/ArrayObject.h   Sun Apr 08 00:01:23 2018 +0000</span><br><span class="line">@@ -60,6 +60,14 @@</span><br><span class="line">         getElementsHeader()-&gt;length = length;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">+    void setCapacityInt32(uint32_t length) &#123;</span><br><span class="line">+        getElementsHeader()-&gt;capacity = length;</span><br><span class="line">+    &#125;</span><br><span class="line">+</span><br><span class="line">+    void setInitializedLengthInt32(uint32_t length) &#123;</span><br><span class="line">+        getElementsHeader()-&gt;initializedLength = length;</span><br><span class="line">+    &#125;</span><br><span class="line">+</span><br><span class="line">     // Make an array object with the specified initial state.</span><br><span class="line">     static inline ArrayObject*</span><br><span class="line">     createArray(JSContext* cx,</span><br></pre></td></tr></table></figure></p>
<p>应用如下所示的补丁，只需仔细检查它是否已正确应用（不应该出现任何冲突）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt;cd gecko-dev\js</span><br><span class="line"></span><br><span class="line">gecko-dev\js&gt;git apply c:\work\codes\blazefox\blaze.patch</span><br><span class="line"></span><br><span class="line">gecko-dev\js&gt;git diff</span><br><span class="line">diff --git a/js/src/builtin/Array.cpp b/js/src/builtin/Array.cpp</span><br><span class="line">index 1655adbf58..e2ee96dd5e 100644</span><br><span class="line">--- a/js/src/builtin/Array.cpp</span><br><span class="line">+++ b/js/src/builtin/Array.cpp</span><br><span class="line">@@ -202,6 +202,20 @@ GetLengthProperty(JSContext* cx, HandleObject obj, uint64_t* lengthp)</span><br><span class="line">     return ToLength(cx, value, lengthp);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">+static MOZ_ALWAYS_INLINE bool</span><br><span class="line">+BlazeSetLengthProperty(JSContext* cx, HandleObject obj, uint64_t length)</span><br><span class="line">+&#123;</span><br><span class="line">+    if (obj-&gt;is&lt;ArrayObject&gt;()) &#123;</span><br><span class="line">+        obj-&gt;as&lt;ArrayObject&gt;().setLengthInt32(length);</span><br><span class="line">+        obj-&gt;as&lt;ArrayObject&gt;().setCapacityInt32(length);</span><br><span class="line">+        obj-&gt;as&lt;ArrayObject&gt;().setInitializedLengthInt32(length);</span><br><span class="line">+        return true;</span><br><span class="line">+    &#125;</span><br><span class="line">+    return false;</span><br><span class="line">+&#125;</span><br></pre></td></tr></table></figure></p>
<p>此时，您可以安装 <a href="https://wiki.mozilla.org/MozillaBuild" title="Mozilla-Build" target="_blank" rel="noopener">Mozilla-Build</a>，它是一个元安装程序，为您提供在 Mozilla 上进行开发所需的所有工具（工具链，各种脚本等）。在撰写本文时，最新的可用版本是版本 3.2，可在此处获得：<a href="https://ftp.mozilla.org/pub/mozilla/libraries/win32/MozillaBuildSetup-3.2.exe" title="MozillaBuildSetup-3.2.exe" target="_blank" rel="noopener">MozillaBuildSetup-3.2.exe</a></p>
<p>安装完成后，通过运行start-shell.bat批处理文件启动Mozilla shell。 转到js \ src文件夹中克隆的位置，然后键入以下内容以配置js.exe的x64调试版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">over@compiler /d/gecko-dev/js/src$ autoconf-2.13</span><br><span class="line"></span><br><span class="line">over@compiler /d/gecko-dev/js/src$ mkdir build.asserts</span><br><span class="line"></span><br><span class="line">over@compiler /d/gecko-dev/js/src$ cd build.asserts</span><br><span class="line"></span><br><span class="line">over@compiler /d/gecko-dev/js/src/build.asserts$ ../configure --host=x86_64-pc-mingw32 --target=x86_64-pc-mingw32 --enable-debug</span><br></pre></td></tr></table></figure></p>
<p>用 mozmake 开始编译<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">over@compiler /d/gecko-dev/js/src/build.asserts$ mozmake -j2</span><br></pre></td></tr></table></figure></p>
<p>然后，你应该能够在一个目录中输入 ./js/src/js.exe,./mozglue/build/mozglue.dll 和 ./config/external/nspr/pr/nspr4.dll 并且这里：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">over@compiler ~/mozilla-central/js/src/build.asserts/js/src</span><br><span class="line">$ js.exe --version</span><br><span class="line">JavaScript-C64.0a1</span><br></pre></td></tr></table></figure></p>
<p>对于优化的构建，您可以通过这种方式调用 configure:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">over@compiler /d/gecko-dev/js/src/build.opt$ ../configure --host=x86_64-pc-mingw32 --target=x86_64-pc-mingw32 --disable-debug --enable-optimize</span><br></pre></td></tr></table></figure></p>
<h2 id="SpiderMonkey"><a href="#SpiderMonkey" class="headerlink" title="SpiderMonkey"></a>SpiderMonkey</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>SpiderMonkey 是 Mozilla 的 JavaScript 引擎的名称，它的源代码可以通过 <a href="https://github.com/mozilla/gecko-dev" title="gecko-dev" target="_blank" rel="noopener">gecko-dev</a> 存储库（在 js 目录下）在 Github 上获得。SpiderMonkey 在 Firefox 使用，更确切地说是由 Web 引擎 Gecko 使用。如果您喜欢它，您甚至可以将解释器嵌入到您自己的第三方应用程序中。 该项目相当大，这里有一些我粗略统计的数据：</p>
<ul>
<li>~3k 个类</li>
<li>~576k 行代码</li>
<li>~1.2k 个文件</li>
<li>~48k 个函数<br>正如您在下面的树形图视图中看到的那样（越大，线越多;蓝色越深，圈复杂度越高）js 引擎基本上分为六大部分：JIT编译器引擎名为 Baseline 和 <a href="https://wiki.mozilla.org/IonMonkey" title="IonMonkey" target="_blank" rel="noopener">IonMonkey</a>在 Jit 目录中，front-end 在 frontend 目录中，JavaScript virtual-machine 在 VM 目录中，一大堆内置函数在 builtin 目录中，垃圾回收器（garbage collector）在 gc 目录中，还有 WebAssembly  在 wasm 目录中。<br><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190821151049-cde47cbc-c3e2-1.png" alt=""></li>
</ul>
<p>我现在看到的大部分内容都存在于vm，builtin和gc文件夹中。对我们来说另一件好事是，还有大量关于SpiderMoneky内部，和设计相关的公共文档等。<br>以下是我发现有趣的一些链接（有些链接可能已过时，但此时我们只是挖掘我们可以找到的所有公开信息）如果您希望在进一步开发之前获得更多背景知识：</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey" title="SpiderMonkeys" target="_blank" rel="noopener">SpiderMonkeys</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Internals" title="SpiderMonkey Internals" target="_blank" rel="noopener">SpiderMonkey Internals</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/JSAPI_User_Guide" title="JSAPI" target="_blank" rel="noopener">JSAPI</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/GC_Rooting_Guide" title="GC Rooting guide" target="_blank" rel="noopener">GC Rooting guide</a></li>
<li><a href="https://wiki.mozilla.org/IonMonkey/Overview" title="IonMonkey JIT" target="_blank" rel="noopener">IonMonkey JIT</a></li>
<li><a href="http://www.aosabook.org/en/posa/memshrink.html" title="The Performance Of Open Source Software: MemShrink" target="_blank" rel="noopener">The Performance Of Open Source Software: MemShrink</a></li>
</ul>
<h3 id="JS-Values-and-JSObjects"><a href="#JS-Values-and-JSObjects" class="headerlink" title="JS::Values and JSObjects"></a>JS::Values and JSObjects</h3><p>您可能首先想到的是本地 JavaScript 对象如何在内存中布局。让我们创建一个包含几种不同本地类型的脚本文件，并直接从内存中dump出来（不要忘记加载符号表）。这里有一个有用的调试技巧，将断点设置为很少被调用的函数，例如Math.atan2 。 由于您可以将任意 JavaScript 对象传递给函数，因此可以非常轻松地从调试器中检索其地址。 您也可以使用 objectAddress，虽然它只能在 shell 中访问，但有时非常有用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">js&gt; a = &#123;&#125;</span><br><span class="line">(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">js&gt; objectAddress(a)</span><br><span class="line">&quot;000002576F8801A0&quot;</span><br></pre></td></tr></table></figure></p>
<p>另一个非常有用的方法是 dumpObject ，但是这个方法只能从 shell 的调试版本中获得：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">js&gt; a = &#123;doare : 1&#125;</span><br><span class="line">(&#123;doare:1&#125;)</span><br><span class="line"></span><br><span class="line">js&gt; dumpObject(a)</span><br><span class="line">object 20003e8e160</span><br><span class="line">  global 20003e8d060 [global]</span><br><span class="line">  class 7ff624d94218 Object</span><br><span class="line">  lazy group</span><br><span class="line">  flags:</span><br><span class="line">  proto &lt;Object at 20003e90040&gt;</span><br><span class="line">  properties:</span><br><span class="line">    &quot;doare&quot;: 1 (shape 20003eb1ad8 enumerate slot 0)</span><br></pre></td></tr></table></figure></p>
<p>还有一些其他可能有趣的实用函数通过 shell 传递给 JavaScript 。如果你想枚举它们，你可以运行Object.getOwnPropertyNames（this）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">js&gt; Object.getOwnPropertyNames(this)</span><br><span class="line">[&quot;undefined&quot;, &quot;Boolean&quot;, &quot;JSON&quot;, &quot;Date&quot;, &quot;Math&quot;, &quot;Number&quot;, &quot;String&quot;, &quot;RegExp&quot;, &quot;InternalError&quot;, &quot;EvalError&quot;, &quot;RangeError&quot;, &quot;TypeError&quot;, &quot;URIError&quot;, &quot;ArrayBuffer&quot;, &quot;Int8Array&quot;, &quot;Uint8Array&quot;, &quot;Int16Array&quot;, &quot;Uint16Array&quot;, &quot;Int32Array&quot;, &quot;Uint32Array&quot;, &quot;Float32Array&quot;, &quot;Float64Array&quot;, &quot;Uint8ClampedArray&quot;, &quot;Proxy&quot;, &quot;WeakMap&quot;, &quot;Map&quot;, ..]</span><br></pre></td></tr></table></figure></p>
<p>要在调用 Math.atan2 JavaScript 函数时中断调试器，可以在以下符号上设置断点：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0:001&gt; bp js!js::math_atan2</span><br></pre></td></tr></table></figure></p>
<p>现在只需创建一个包含以下内容的 foo.js 文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">const Address = Math.atan2;</span><br><span class="line"></span><br><span class="line">const A = 0x1337;</span><br><span class="line">Address(A);</span><br><span class="line"></span><br><span class="line">const B = 13.37;</span><br><span class="line">Address(B);</span><br><span class="line"></span><br><span class="line">const C = [1, 2, 3, 4, 5];</span><br><span class="line">Address(C);</span><br></pre></td></tr></table></figure></p>
<p>此时您有两个选择：要么将上述脚本加载到 JavaScript shell 中并附加调试器，要么我建议使用 TTD 跟踪程序执行。当您尝试研究复杂的软件时，它会使事情变得如此简单。如果你从未尝试过，现在就去做，你会明白的。<br>是时候加载跟踪并浏览一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">0:001&gt; g</span><br><span class="line">Breakpoint 0 hit</span><br><span class="line">js!js::math_atan2:</span><br><span class="line">00007ff6`9b3fe140 56              push    rsi</span><br><span class="line"></span><br><span class="line">0:000&gt; lsa .</span><br><span class="line">   260: &#125;</span><br><span class="line">   261: </span><br><span class="line">   262: bool</span><br><span class="line">   263: js::math_atan2(JSContext* cx, unsigned argc, Value* vp)</span><br><span class="line">&gt;  264: &#123;</span><br><span class="line">   265:     CallArgs args = CallArgsFromVp(argc, vp);</span><br><span class="line">   266: </span><br><span class="line">   267:     return math_atan2_handle(cx, args.get(0), args.get(1), args.rval());</span><br><span class="line">   268: &#125;</span><br><span class="line">   269:</span><br></pre></td></tr></table></figure></p>
<p>此时，你应该像上面那样中断调试器。 为了能够检查传递的 JavaScript 对象，我们需要了解如何将 JavaScript 参数传递给本机 C++ 函数。<br>它的工作方式是：vp 是一个大小为 argc + 2 的 JS :: Value 数组的指针（一个用于返回值/调用者，一个用于 this 对象）。函数通常不直接通过 vp 访问数组。而是将它包装在一个 JS :: CallArgs 对象中，该对象抽象出需要计算的 JS :: Value 的数量，并提供其功能，如：JS :: CallArgs :: get，JS :: CallArgs :: rval等。它还抽象出与 GC 相关的操作，以使对象保持活动状态。 所以我们需 dump vp 指向的内存。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; dqs @r8 l@rdx+2</span><br><span class="line">0000028f`87ab8198  fffe028f`877a9700</span><br><span class="line">0000028f`87ab81a0  fffe028f`87780180</span><br><span class="line">0000028f`87ab81a8  fff88000`00001337</span><br></pre></td></tr></table></figure></p>
<p>我们注意到的第一件事是每个 Value 对象好像都设置了高8位。 通常，在指针中设置一个hax的标志来编码更多的信息（比如类型，译者注：这高8位实际上是表明了数据的类型，0xfff88000 表示 0x00001337 是个整型数据），因为这部分地址空间无法从 Windows 上的用户模式寻址。<br>至少我们认识到 0x1337 值是什么。 让我们继续第二次调用 Addressnow。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; g</span><br><span class="line">Breakpoint 0 hit</span><br><span class="line">js!js::math_atan2:</span><br><span class="line">00007ff6`9b3fe140 56              push    rsi</span><br><span class="line"></span><br><span class="line">0:000&gt; dqs @r8 l@rdx+2</span><br><span class="line">0000028f`87ab8198  fffe028f`877a9700</span><br><span class="line">0000028f`87ab81a0  fffe028f`87780180</span><br><span class="line">0000028f`87ab81a8  402abd70`a3d70a3d</span><br><span class="line"></span><br><span class="line">0:000&gt; .formats 402abd70`a3d70a3d</span><br><span class="line">Evaluate expression:</span><br><span class="line">  Hex:     402abd70`a3d70a3d</span><br><span class="line">  Double:  13.37</span><br></pre></td></tr></table></figure></p>
<p>这是另一个我们认识到的常数。这次，整个 quad-word 用于表示 double 数。 最后，这里是传递给“Address”的第三次调用的 Array 对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; g</span><br><span class="line">Breakpoint 0 hit</span><br><span class="line">js!js::math_atan2:</span><br><span class="line">00007ff6`9b3fe140 56              push    rsi</span><br><span class="line"></span><br><span class="line">0:000&gt; dqs @r8 l@rdx+2</span><br><span class="line">0000028f`87ab8198  fffe028f`877a9700</span><br><span class="line">0000028f`87ab81a0  fffe028f`87780180</span><br><span class="line">0000028f`87ab81a8  fffe028f`87790400</span><br></pre></td></tr></table></figure></p>
<p>有趣。如果我们看一下 JS :: Value 结构，看起来 quad-word 的下半部分是指向某个对象的指针。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; dt -r2 js::value</span><br><span class="line">   +0x000 asBits_          : Uint8B</span><br><span class="line">   +0x000 asDouble_        : Float</span><br><span class="line">   +0x000 s_               : JS::Value::&lt;unnamed-type-s_&gt;</span><br><span class="line">      +0x000 payload_         : JS::Value::&lt;unnamed-type-s_&gt;::&lt;unnamed-type-payload_&gt;</span><br><span class="line">         +0x000 i32_             : Int4B</span><br><span class="line">         +0x000 u32_             : Uint4B</span><br><span class="line">         +0x000 why_             : JSWhyMagic</span><br></pre></td></tr></table></figure></p>
<p>通过查看 public / Value.h，我们很快就能理解上面所看到的内容。JS :: Value 的 17 个高位（在源代码中称为 JSVAL_TAG）用于编码类型信息。较低的 47 位（称为 JSVAL_TAG_SHIFT）是普通类型的值（整数，布尔值等）或指向JSObject 的指针。 这部分称为 payload_<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">union alignas(8) Value &#123;</span><br><span class="line">  private:</span><br><span class="line">    uint64_t asBits_;</span><br><span class="line">    double asDouble_;</span><br><span class="line"></span><br><span class="line">    struct &#123;</span><br><span class="line">        union &#123;</span><br><span class="line">            int32_t i32_;</span><br><span class="line">            uint32_t u32_;</span><br><span class="line">            JSWhyMagic why_;</span><br><span class="line">        &#125; payload_;</span><br></pre></td></tr></table></figure></p>
<p>现在让我们以 JS :: Value 0xfff8800000001337 为例。 要提取它的标记位，我们可以把它右移 47，并提取有payload_ （这里是一个整数，一个普通的类型），我们可以用 2**47  -  1 覆盖它。与上面的数组 JS :: Value相同。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [5]: v = 0xfff8800000001337</span><br><span class="line"></span><br><span class="line">In [6]: hex(v &gt;&gt; 47)</span><br><span class="line">Out[6]: &apos;0x1fff1L&apos;</span><br><span class="line"></span><br><span class="line">In [7]: hex(v &amp; ((2**47) - 1))</span><br><span class="line">Out[7]: &apos;0x1337L&apos;</span><br><span class="line"></span><br><span class="line">In [8]: v = 0xfffe028f877a9700 </span><br><span class="line"></span><br><span class="line">In [9]: hex(v &gt;&gt; 47)</span><br><span class="line">Out[9]: &apos;0x1fffcL&apos;</span><br><span class="line"></span><br><span class="line">In [10]: hex(v &amp; ((2**47) - 1))</span><br><span class="line">Out[10]: &apos;0x28f877a9700L&apos;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190821151120-e04d4e6a-c3e2-1.png" alt="image.png"></p>
<p>上面的 0x1fff1 常量是 JSVAL_TAG_INT32，而 0x1fffc 是 JSValueType 中定义的 JSVAL_TAG_OBJECT，这都是有依据的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">enum JSValueType : uint8_t</span><br><span class="line">&#123;</span><br><span class="line">    JSVAL_TYPE_DOUBLE              = 0x00,</span><br><span class="line">    JSVAL_TYPE_INT32               = 0x01,</span><br><span class="line">    JSVAL_TYPE_BOOLEAN             = 0x02,</span><br><span class="line">    JSVAL_TYPE_UNDEFINED           = 0x03,</span><br><span class="line">    JSVAL_TYPE_NULL                = 0x04,</span><br><span class="line">    JSVAL_TYPE_MAGIC               = 0x05,</span><br><span class="line">    JSVAL_TYPE_STRING              = 0x06,</span><br><span class="line">    JSVAL_TYPE_SYMBOL              = 0x07,</span><br><span class="line">    JSVAL_TYPE_PRIVATE_GCTHING     = 0x08,</span><br><span class="line">    JSVAL_TYPE_OBJECT              = 0x0c,</span><br><span class="line"></span><br><span class="line">    // These never appear in a jsval; they are only provided as an out-of-band</span><br><span class="line">    // value.</span><br><span class="line">    JSVAL_TYPE_UNKNOWN             = 0x20,</span><br><span class="line">    JSVAL_TYPE_MISSING             = 0x21</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">JS_ENUM_HEADER(JSValueTag, uint32_t)</span><br><span class="line">&#123;</span><br><span class="line">    JSVAL_TAG_MAX_DOUBLE           = 0x1FFF0,</span><br><span class="line">    JSVAL_TAG_INT32                = JSVAL_TAG_MAX_DOUBLE | JSVAL_TYPE_INT32,</span><br><span class="line">    JSVAL_TAG_UNDEFINED            = JSVAL_TAG_MAX_DOUBLE | JSVAL_TYPE_UNDEFINED,</span><br><span class="line">    JSVAL_TAG_NULL                 = JSVAL_TAG_MAX_DOUBLE | JSVAL_TYPE_NULL,</span><br><span class="line">    JSVAL_TAG_BOOLEAN              = JSVAL_TAG_MAX_DOUBLE | JSVAL_TYPE_BOOLEAN,</span><br><span class="line">    JSVAL_TAG_MAGIC                = JSVAL_TAG_MAX_DOUBLE | JSVAL_TYPE_MAGIC,</span><br><span class="line">    JSVAL_TAG_STRING               = JSVAL_TAG_MAX_DOUBLE | JSVAL_TYPE_STRING,</span><br><span class="line">    JSVAL_TAG_SYMBOL               = JSVAL_TAG_MAX_DOUBLE | JSVAL_TYPE_SYMBOL,</span><br><span class="line">    JSVAL_TAG_PRIVATE_GCTHING      = JSVAL_TAG_MAX_DOUBLE | JSVAL_TYPE_PRIVATE_GCTHING,</span><br><span class="line">    JSVAL_TAG_OBJECT               = JSVAL_TAG_MAX_DOUBLE | JSVAL_TYPE_OBJECT</span><br><span class="line">&#125; JS_ENUM_FOOTER(JSValueTag);</span><br></pre></td></tr></table></figure></p>
<p>现在我们知道什么是 JS :: Value，让我们看一下 Array 在内存中的样子，因为这会在之后用到。 重新启动目标并跳过第一个双重中断。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; .restart /f</span><br><span class="line"></span><br><span class="line">0:008&gt; g</span><br><span class="line">Breakpoint 0 hit</span><br><span class="line">js!js::math_atan2:</span><br><span class="line">00007ff6`9b3fe140 56              push    rsi</span><br><span class="line"></span><br><span class="line">0:000&gt; g</span><br><span class="line">Breakpoint 0 hit</span><br><span class="line">js!js::math_atan2:</span><br><span class="line">00007ff6`9b3fe140 56              push    rsi</span><br><span class="line"></span><br><span class="line">0:000&gt; g</span><br><span class="line">Breakpoint 0 hit</span><br><span class="line">js!js::math_atan2:</span><br><span class="line">00007ff6`9b3fe140 56              push    rsi</span><br><span class="line"></span><br><span class="line">0:000&gt; dqs @r8 l@rdx+2</span><br><span class="line">0000027a`bf5b8198  fffe027a`bf2a9480</span><br><span class="line">0000027a`bf5b81a0  fffe027a`bf280140</span><br><span class="line">0000027a`bf5b81a8  fffe027a`bf2900a0</span><br><span class="line"></span><br><span class="line">0:000&gt; dqs 27a`bf2900a0</span><br><span class="line">0000027a`bf2900a0  0000027a`bf27ab20</span><br><span class="line">0000027a`bf2900a8  0000027a`bf2997e8</span><br><span class="line">0000027a`bf2900b0  00000000`00000000</span><br><span class="line">0000027a`bf2900b8  0000027a`bf2900d0</span><br><span class="line">0000027a`bf2900c0  00000005`00000000</span><br><span class="line">0000027a`bf2900c8  00000005`00000006</span><br><span class="line">0000027a`bf2900d0  fff88000`00000001</span><br><span class="line">0000027a`bf2900d8  fff88000`00000002</span><br><span class="line">0000027a`bf2900e0  fff88000`00000003</span><br><span class="line">0000027a`bf2900e8  fff88000`00000004</span><br><span class="line">0000027a`bf2900f0  fff88000`00000005</span><br><span class="line">0000027a`bf2900f8  4f4f4f4f`4f4f4f4f</span><br></pre></td></tr></table></figure></p>
<p>此时我们认识到数组的内容：从 1 到 5 的数值，作为 JS :: Value 的五个整数。我们也可以看到哪个位置的数据可能是存放的数组大小和容量，但剩下的数据很难猜到存放的是什么。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; dt JSObject</span><br><span class="line">   +0x000 group_           : js::GCPtr&lt;js::ObjectGroup *&gt;</span><br><span class="line">   +0x008 shapeOrExpando_  : Ptr64 Void</span><br><span class="line"></span><br><span class="line">0:000&gt; dt js::NativeObject</span><br><span class="line">   +0x000 group_           : js::GCPtr&lt;js::ObjectGroup *&gt;</span><br><span class="line">   +0x008 shapeOrExpando_  : Ptr64 Void</span><br><span class="line">   +0x010 slots_           : Ptr64 js::HeapSlot</span><br><span class="line">   +0x018 elements_        : Ptr64 js::HeapSlot</span><br><span class="line"></span><br><span class="line">0:000&gt; dt js::ArrayObject</span><br><span class="line">   +0x000 group_           : js::GCPtr&lt;js::ObjectGroup *&gt;</span><br><span class="line">   +0x008 shapeOrExpando_  : Ptr64 Void</span><br><span class="line">   +0x010 slots_           : Ptr64 js::HeapSlot</span><br><span class="line">   +0x018 elements_        : Ptr64 js::HeapSlot</span><br></pre></td></tr></table></figure></p>
<p>JS :: ArrayObject 在 vm / ArrayObject.h 文件中定义，它是 JS :: NativeObject 类的子类（JS :: NativeObject 子类 JS :: ShapedObject，它自然是 JSObject 的子类）。 请注意，它也基本上是每个其他 JavaScript 对象的子类，如下图所示：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190821152236-731ffb56-c3e4-1.png" alt="image.png"></p>
<p>SpiderMonkey 中的本地对象基本上由两个组件组成：</p>
<ul>
<li>一个形状对象，用于描述属性，所述对象的类，更多的是在下面（由字段 shapeOrExpando_ 指向）。</li>
<li>存储元素或属性值的存储。</li>
</ul>
<p>让我们看看对象属性如何存储在内存中。</p>
<h3 id="Shapes"><a href="#Shapes" class="headerlink" title="Shapes"></a>Shapes</h3><p>如上所述，shape 对象的作用是描述对象具有的各种属性。从概念上讲，您可以将其视为某种哈希表，其中 Key 是属性名称，值是实际存储属性内容的 slot 。<br>在进一步阅读之前，我建议您观看由 <a href="https://twitter.com/bmeurer" title="@bmeurer" target="_blank" rel="noopener">@bmeurer</a> 和 <a href="https://twitter.com/mathias" title="@mathias" target="_blank" rel="noopener">@mathias</a> 撰写的非常简短的演示文稿，描述如何在 JavaScript 引擎中存储属性：<a href="https://mathiasbynens.be/notes/shapes-ics" title="JavaScript 引擎基础：形状和内联缓存" target="_blank" rel="noopener">JavaScript 引擎基础：形状和内联缓存</a>。 他们清楚地解释这方面的事，它应该有助于理解接下来会发生什么，这也意味着我不需要尽可能多地介绍。<br>考虑以下 JavaScript 代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">const Address = Math.atan2;</span><br><span class="line"></span><br><span class="line">const A = &#123;</span><br><span class="line">    foo : 1337,</span><br><span class="line">    blah : &apos;doar-e&apos;</span><br><span class="line">&#125;;</span><br><span class="line">Address(A);</span><br><span class="line"></span><br><span class="line">const B = &#123;</span><br><span class="line">    foo : 1338,</span><br><span class="line">    blah : &apos;sup&apos;</span><br><span class="line">&#125;;</span><br><span class="line">Address(B);</span><br><span class="line"></span><br><span class="line">const C = &#123;</span><br><span class="line">    foo : 1338,</span><br><span class="line">    blah : &apos;sup&apos;</span><br><span class="line">&#125;;</span><br><span class="line">C.another = true;</span><br><span class="line">Address(C);</span><br></pre></td></tr></table></figure></p>
<p>将它放在您最喜欢的调试器下面的 shell 中，以便仔细查看此 shape 对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; bp js!js::math_atan2</span><br><span class="line"></span><br><span class="line">0:000&gt; g</span><br><span class="line">Breakpoint 0 hit</span><br><span class="line">Time Travel Position: D454:D</span><br><span class="line">js!js::math_atan2:</span><br><span class="line">00007ff7`76c9e140 56              push    rsi</span><br><span class="line"></span><br><span class="line">0:000&gt; ?? vp[2].asBits_</span><br><span class="line">unsigned int64 0xfffe01fc`e637e1c0</span><br><span class="line"></span><br><span class="line">0:000&gt; dt js::NativeObject 1fc`e637e1c0 shapeOrExpando_</span><br><span class="line">   +0x008 shapeOrExpando_ : 0x000001fc`e63ae880 Void</span><br><span class="line"></span><br><span class="line">0:000&gt; ?? ((js::shape*)0x000001fc`e63ae880)</span><br><span class="line">class js::Shape * 0x000001fc`e63ae880</span><br><span class="line">   +0x000 base_            : js::GCPtr&lt;js::BaseShape *&gt;</span><br><span class="line">   +0x008 propid_          : js::PreBarriered&lt;jsid&gt;</span><br><span class="line">   +0x010 immutableFlags   : 0x2000001</span><br><span class="line">   +0x014 attrs            : 0x1 &apos;&apos;</span><br><span class="line">   +0x015 mutableFlags     : 0 &apos;&apos;</span><br><span class="line">   +0x018 parent           : js::GCPtr&lt;js::Shape *&gt;</span><br><span class="line">   +0x020 kids             : js::KidsPointer</span><br><span class="line">   +0x020 listp            : (null) </span><br><span class="line"></span><br><span class="line">0:000&gt; ?? ((js::shape*)0x000001fc`e63ae880)-&gt;propid_.value</span><br><span class="line">struct jsid</span><br><span class="line">   +0x000 asBits           : 0x000001fc`e63a7e20</span><br></pre></td></tr></table></figure></p>
<p>在实现中，JS :: Shape 描述了一个属性；它的名称和 slot 号。为了描述它们中的几个，通过父字段（和其他字段）将 shapes 链接在一起。slot 号（稍后用于查找属性内容）存储在 immutableFlags 字段的低位中。属性名称存储为 propid_ 字段中的 jsid 。<br>我知道现在你面前有很多抽象的信息。但是，让我们一层一层的来分析; 从上面的 shape 开始。此 JS :: Shape 对象描述了一个属性，该值存储在 slot 号为 1（0x2000001 和 SLOT_MASK）中。为了得到它的名字，我们转储它的propid_ 字段，即 0x000001fce63a7e20 。<br>什么是 jsid ？ jsid 是另一种类型的标记指针，其中类型信息这次以低三位编码。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190821154425-7fb4f4fe-c3e7-1.png" alt="image.png"></p>
<p>感谢那些较低的位，我们知道这个地址指向一个字符串，它应该匹配我们的属性名称:)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; ?? (char*)((JSString*)0x000001fc`e63a7e20)-&gt;d.inlineStorageLatin1</span><br><span class="line">char * 0x000001fc`e63a7e28</span><br><span class="line"> &quot;blah&quot;</span><br></pre></td></tr></table></figure></p>
<p>如上所述， shape 对象链接在一起。 如果我们转储其父级，我们希望找到描述我们的第二个属性 foo 的 shape：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; ?? ((js::shape*)0x000001fc`e63ae880)-&gt;parent.value</span><br><span class="line">class js::Shape * 0x000001fc`e63ae858</span><br><span class="line">   +0x000 base_            : js::GCPtr&lt;js::BaseShape *&gt;</span><br><span class="line">   +0x008 propid_          : js::PreBarriered&lt;jsid&gt;</span><br><span class="line">   +0x010 immutableFlags   : 0x2000000</span><br><span class="line">   +0x014 attrs            : 0x1 &apos;&apos;</span><br><span class="line">   +0x015 mutableFlags     : 0x2 &apos;&apos;</span><br><span class="line">   +0x018 parent           : js::GCPtr&lt;js::Shape *&gt;</span><br><span class="line">   +0x020 kids             : js::KidsPointer</span><br><span class="line">   +0x020 listp            : 0x000001fc`e63ae880 js::GCPtr&lt;js::Shape *&gt;</span><br><span class="line"></span><br><span class="line">0:000&gt; ?? ((js::shape*)0x000001fc`e63ae880)-&gt;parent.value-&gt;propid_.value</span><br><span class="line">struct jsid</span><br><span class="line">   +0x000 asBits           : 0x000001fc`e633d700</span><br><span class="line"></span><br><span class="line">0:000&gt; ?? (char*)((JSString*)0x000001fc`e633d700)-&gt;d.inlineStorageLatin1</span><br><span class="line">char * 0x000001fc`e633d708</span><br><span class="line"> &quot;foo&quot;</span><br></pre></td></tr></table></figure></p>
<p>按 g 继续执行并检查第二个对象是否共享相同的形状层次结构（0x000001fce63ae880）:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; g</span><br><span class="line">Breakpoint 0 hit</span><br><span class="line">Time Travel Position: D484:D</span><br><span class="line">js!js::math_atan2:</span><br><span class="line">00007ff7`76c9e140 56              push    rsi</span><br><span class="line"></span><br><span class="line">0:000&gt; ?? vp[2].asBits_</span><br><span class="line">unsigned int64 0xfffe01fc`e637e1f0</span><br><span class="line"></span><br><span class="line">0:000&gt; dt js::NativeObject 1fc`e637e1f0 shapeOrExpando_</span><br><span class="line">   +0x008 shapeOrExpando_ : 0x000001fc`e63ae880 Void</span><br></pre></td></tr></table></figure></p>
<p>正如预期的那样，B 确实会分享它，即使 A和 B 存储不同的属性值。 关注我们现在向 C 添加另一个属性时会发生什么？ 要查找，请最后按 g 一次：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; g</span><br><span class="line">Breakpoint 0 hit</span><br><span class="line">Time Travel Position: D493:D</span><br><span class="line">js!js::math_atan2:</span><br><span class="line">00007ff7`76c9e140 56              push    rsi</span><br><span class="line"></span><br><span class="line">0:000&gt; ?? vp[2].asBits_</span><br><span class="line">union JS::Value</span><br><span class="line">   +0x000 asBits_          : 0xfffe01e7`c247e1c0</span><br><span class="line"></span><br><span class="line">0:000&gt; dt js::NativeObject 1fc`e637e1f0 shapeOrExpando_</span><br><span class="line">   +0x008 shapeOrExpando_ : 0x000001fc`e63b10d8 Void</span><br><span class="line"></span><br><span class="line">0:000&gt; ?? ((js::shape*)0x000001fc`e63b10d8)</span><br><span class="line">class js::Shape * 0x000001fc`e63b10d8</span><br><span class="line">   +0x000 base_            : js::GCPtr&lt;js::BaseShape *&gt;</span><br><span class="line">   +0x008 propid_          : js::PreBarriered&lt;jsid&gt;</span><br><span class="line">   +0x010 immutableFlags   : 0x2000002</span><br><span class="line">   +0x014 attrs            : 0x1 &apos;&apos;</span><br><span class="line">   +0x015 mutableFlags     : 0 &apos;&apos;</span><br><span class="line">   +0x018 parent           : js::GCPtr&lt;js::Shape *&gt;</span><br><span class="line">   +0x020 kids             : js::KidsPointer</span><br><span class="line">   +0x020 listp            : (null) </span><br><span class="line"></span><br><span class="line">0:000&gt; ?? ((js::shape*)0x000001fc`e63b10d8)-&gt;propid_.value</span><br><span class="line">struct jsid</span><br><span class="line">   +0x000 asBits           : 0x000001fc`e63a7e60</span><br><span class="line"></span><br><span class="line">0:000&gt; ?? (char*)((JSString*)0x000001fc`e63a7e60)-&gt;d.inlineStorageLatin1</span><br><span class="line">char * 0x000001fc`e63a7e68</span><br><span class="line"> &quot;another&quot;</span><br><span class="line"></span><br><span class="line">0:000&gt; ?? ((js::shape*)0x000001fc`e63b10d8)-&gt;parent.value</span><br><span class="line">class js::Shape * 0x000001fc`e63ae880</span><br></pre></td></tr></table></figure></p>
<p>新的 JS :: Shape 被分配（0x000001e7c24b1150），其父级是前一组形状（0x000001e7c24b1150）。 有点像在链表中添加节点。</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190821155118-75dbbff2-c3e8-1.png" alt="image.png"></p>
<h3 id="Slots"><a href="#Slots" class="headerlink" title="Slots"></a>Slots</h3><p>在上一节中，我们讨论了很多关于属性名称如何存储在内存中的问题。 那属性的值在哪里呢？</p>
<p>为了回答这个问题，我们抛出了我们在调试器中获得的先前 TTD 跟踪，并在第一次调用 Math.atan2 时返回：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Breakpoint 0 hit</span><br><span class="line">Time Travel Position: D454:D</span><br><span class="line">js!js::math_atan2:</span><br><span class="line">00007ff7`76c9e140 56              push    rsi</span><br><span class="line"></span><br><span class="line">0:000&gt; ?? vp[2].asBits_</span><br><span class="line">unsigned int64 0xfffe01fc`e637e1c0</span><br></pre></td></tr></table></figure></p>
<p>因为我们已经 dump 了描述 foo 和 blah 属性的 js :: Shape 对象的过程，所以我们知道它们的属性值分别存储在slot 0 和 slot 1 中。 为了查看这些，我们只是在 js :: NativeObject 之后 dump 内存：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; ?? vp[2].asBits_</span><br><span class="line">unsigned int64 0xfffe01fc`e637e1c0</span><br><span class="line">0:000&gt; dt js::NativeObject 1fce637e1c0</span><br><span class="line">   +0x000 group_           : js::GCPtr&lt;js::ObjectGroup *&gt;</span><br><span class="line">   +0x008 shapeOrExpando_  : 0x000001fc`e63ae880 Void</span><br><span class="line">   +0x010 slots_           : (null) </span><br><span class="line">   +0x018 elements_        : 0x00007ff7`7707dac0 js::HeapSlot</span><br><span class="line"></span><br><span class="line">0:000&gt; dqs 1fc`e637e1c0</span><br><span class="line">000001fc`e637e1c0  000001fc`e637a520</span><br><span class="line">000001fc`e637e1c8  000001fc`e63ae880</span><br><span class="line">000001fc`e637e1d0  00000000`00000000</span><br><span class="line">000001fc`e637e1d8  00007ff7`7707dac0 js!emptyElementsHeader+0x10</span><br><span class="line">000001fc`e637e1e0  fff88000`00000539 &lt;- foo</span><br><span class="line">000001fc`e637e1e8  fffb01fc`e63a7e40 &lt;- blah</span><br></pre></td></tr></table></figure></p>
<p>当然，第二个属性是指向 JSString 的另一个 js :: Value，我们也可以 dump 它：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; ?? (char*)((JSString*)0x1fce63a7e40)-&gt;d.inlineStorageLatin1</span><br><span class="line">char * 0x000001fc`e63a7e48</span><br><span class="line"> &quot;doar-e&quot;</span><br></pre></td></tr></table></figure></p>
<p>下面是一个描述对象层次结构的图表，以清除任何可能的混淆：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190821155510-0002c590-c3e9-1.png" alt="image.png"></p>
<p>到目前，我想要描述的内容都已经被涵盖的差不多了，它应该足以帮助我们理解接下来的内容。你可以使用此背景检查大多数 JavaScript 对象。我遇到的唯一 “odd-balls” 类型是存储长度属性的 JavaScript 数组，例如在 js :: ObjectElements 对象中; 但这就是它。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; dt js::ObjectElements</span><br><span class="line">   +0x000 flags            : Uint4B</span><br><span class="line">   +0x004 initializedLength : Uint4B</span><br><span class="line">   +0x008 capacity         : Uint4B</span><br><span class="line">   +0x00c length           : Uint4B</span><br></pre></td></tr></table></figure></p>
</div><iframe src="/donate/?AliPayQR=null&amp;WeChatQR=/img/mePic.jpg&amp;GitHub=null&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><div class="tags"><a href="/tags/漏洞利用/">漏洞利用</a></div><div class="post-nav"><a class="pre" href="/2020/11/15/spiderMonkey-漏洞利用简介2/">spiderMonkey 漏洞利用简介2</a><a class="next" href="/2020/07/27/X86-ShellCode-2/">X86-ShellCode编写2</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'o3qEIvAEzJfA0jPzjvyVeUwo-gzGzoHsz',
  appKey:'VBV3VN2vtqwbGqHGFeNL86iw',
  placeholder:'thanks for you read',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://f01965.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CVE-2018/">CVE / 2018</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术分享/">技术分享</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/日志/">日志</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/GC/" style="font-size: 15px;">GC</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/CTF-web/" style="font-size: 15px;">CTF-web</a> <a href="/tags/漏洞利用-固件/" style="font-size: 15px;">漏洞利用 固件</a> <a href="/tags/技术分享/" style="font-size: 15px;">技术分享</a> <a href="/tags/机器学习框架/" style="font-size: 15px;">机器学习框架</a> <a href="/tags/漏洞利用/" style="font-size: 15px;">漏洞利用</a> <a href="/tags/code/" style="font-size: 15px;">code</a> <a href="/tags/技术分享-固件/" style="font-size: 15px;">技术分享 固件</a> <a href="/tags/Mircosoft/" style="font-size: 15px;">Mircosoft</a> <a href="/tags/固件/" style="font-size: 15px;">固件</a> <a href="/tags/fuzz/" style="font-size: 15px;">fuzz</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/02/18/fortigate/">fortigate</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/15/spiderMonkey-漏洞利用简介3/">spiderMonkey 漏洞利用简介3</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/15/spiderMonkey-漏洞利用简介2/">spiderMonkey 漏洞利用简介2</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/11/15/spiderMonkey-漏洞利用简介/">spiderMonkey 漏洞利用简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/27/X86-ShellCode-2/">X86-ShellCode编写2</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/27/X86-ShellCode-1/">X86-ShellCode编写1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/26/CVE-2017-17215-拓展/">CVE-2017-17215 拓展</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/25/CVE-2017-17215/">CVE-2017-17215</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/18/Cisco-IOS-分析/">Cisco-IOS 分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/28/Chrome-沙盒逃逸/">Chrome 沙盒逃逸</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://yan-1-20.github.io/about/" title="Asprose" target="_blank">Asprose</a><ul></ul><a href="https://www.lucifaer.com/" title="Lucifaer" target="_blank">Lucifaer</a><ul></ul><a href="http://drac0nids.top/" title="Drac0nids" target="_blank">Drac0nids</a><ul></ul><a href="http://balis0ng.com/" title="balis0ng" target="_blank">balis0ng</a><ul></ul><a href="https://da7uran0ir.github.io/" title="Da7ura_n0ir" target="_blank">Da7ura_n0ir</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer"> Dad ， I will always love you.</div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" color="255,0,0" opacity="0.7" zIndex="-1" count="100" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>